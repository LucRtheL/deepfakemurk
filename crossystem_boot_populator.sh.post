










. /usr/share/misc/chromeos-common.sh || :



traps() {
    set -e
    trap 'last_command=$current_command; current_command=$BASH_COMMAND' DEBUG
    trap 'echo "\"${last_command}\" command failed with exit code $?. THIS IS A BUG, REPORT IT HERE https://github.com/MercuryWorkshop/fakemurk"' EXIT
}
leave() {
    trap - EXIT
    echo "exiting successfully"
    exit
}
config() {
    swallow_stdin

    swallow_stdin
    echo
    read -r -p "Would you like to enable rootfs restore? It will add an option to quickly revert all changes and re-enroll. (Y/n)" choice
    case "$choice" in
    N | n | no | No | NO) ROOTFS_BACKUP=0 ;;
    *) ROOTFS_BACKUP=1 ;;
    esac

    if [ "$DEVBUILD" == "1" ]; then
        devbuild_config
    fi
}

swallow_stdin() {
    while read -t 0 notused; do
        read input
    done
}

fakemurk_info() {
    ascii_info
    sleep 3
    cat <<-EOF

WARNING: THIS SCRIPT WILL REQUIRE THE REMOVAL OF ROOTFS VERIFICATION, AND THE DISABLING OF AUTOUPDATES
THIS MEANS THAT IF YOU EVER TURN OFF DEVMODE, YOUR SYSTEM WILL BE BRICKED UNTIL RECOVERY

WE ARE NOT RESPONSIBLE FOR DAMAGE, YOU BEING STUPID AND MISUSING THIS, OR GETTING IN TROUBLE
DO YOU UNDERSTAND??

(enter to proceed, ctrl+c to quit)
EOF
    swallow_stdin
    read -r
}

csys() {
    if [ "$COMPAT" == "1" ]; then
        crossystem "$@"
    elif test -f "$ROOT/usr/bin/crossystem.old"; then
        "$ROOT/usr/bin/crossystem.old" "$@"
    else
        "$ROOT/usr/bin/crossystem" "$@"
    fi
}
cvpd() {
    if [ "$COMPAT" == "1" ]; then
        vpd "$@"
    elif test -f "$ROOT/usr/sbin/vpd.old"; then
        "$ROOT/usr/sbin/vpd.old" "$@"
    else
        "$ROOT/usr/sbin/vpd" "$@"
    fi
}

sed_escape() {
    echo -n "$1" | while read -n1 ch; do
        if [[ "$ch" == "" ]]; then
            echo -n "\n"
            # dumbass shellcheck not expanding is the entire point
        fi
        echo -n "\\x$(printf %x \'"$ch")"
    done
}

raw_crossystem_sh() {
    base64 -d <<-EOF | bunzip2 -dc
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
bzVPfi2mxFTkn/F3JFOFCQFdrstw
EOF
}

raw_pollen() {
    base64 -d <<-EOF | bunzip2 -dc
QlpoOTFBWSZTWfFIZiwABG/fgAAyUARgED/3/6q/79/qUAO+3dmZCO611xwSSCjCaZoCp+lPU80app6gA9NQGglAQIoxQ9NEbUDa
AACaaaYSmhIxTSm9CeUjaTRtR6gAaDRoGA0AAA0AAAAAASSaSemSNTyh6gepoB6hoDQNDQwICCEBUgA2selAQHfq+NrmyGxoEYj6
2iaKeiniJI7klqWHhsW9axNmJVC6+iiagQDeabTISZL6akEAaodkwiBxyHdCTMkNBiDLYKIIDN5U9SHV+NGlX3jg05NrZ54kTZvY
1wRWrZ1zV6bdLiqs4yrsoiH+VaFJRoKqlxViuit51VE9dNBzGeMrvI/fT5KWlnJZO0g0EtI1JcyvlS0fuLKaYl6OPoobPDOJfPhM
5taBQ7rd4ERtorsi2/AwKO+kiIyUl1vz3x/NuyD0bLwLieBbxPzirZMMJuJmqG8Lzo3jTIlPdUmgpH9R3Rvr+ZZZlpTQSyJX/XmF
NgFd3cqKcOTDLoyR6sis5GDas8e0PGGHzN3Y1ypajpkmbBMzPKQ7JWmsxMmFCeZrS7+voOCYSSSEhux51679tVja8wuJgYkaUshJ
q8+nvRe55H7SrCYSZJINrvTvA9Jm/uepmHVxgMuB1poR55iqrG2r91DYeXHZjnnKxd9OWrQnw0EeOuDvJGIGirDmcEq2UEL2wItA
LMSqcfjc7WJkTWsbOQU4qLr3dv5tVFq0oOidu02pdWvYUuFDyCZmNCu06bRWwD89ra4KYyY3OMWGhmyEFabguvsyGwizwZA0sZsY
9Y1SmCCwbtQiu4MlClLUIbVdC4GFm9vZee+8qOHWxlOt0bJv6qVVjcib6E1ky2c5TL2tmhUZYG8GhyyUGsawIDARfIEHO4MeNrD1
y7ECY9cHvOnB2mkRiVTCnJ3Ex+xuXa3RmMnoQGOGrwIxVpjKAav26JcMgKMboSXEcZ0c9e7++/kdJapichFwlQmhCOrEcnBGEEG6
Z9uHAqi8zV68631PArMVHEatSJqxAODuZ73bs6HGFSnFw7oZbRGxd1aUxwBeboLJ9Pxs5tLyDRkmEIOMm6SSqcGaFUMzazMqb7sM
1ViTeMGLwbQrh3L5RgtrRIVKpfCi2jIkkUOVAKiGjBd7o+MNc+cUB/rLQQa7gPJvxuvMYXvjhviaq0uOMClD5OSRQx70mcpVRT2W
c1Rex6en/F3JFOFCQ8UhmLA=
EOF
}
drop_daemon() {
    base64 -d <<-EOF | bunzip2 -dc >"$ROOT/etc/init/pre-startup.conf"
QlpoOTFBWSZTWWmlwXUAAGJfgEAQeef/EX8nngR//9/gQAKdbYrYtsYanqaCmRimZJ7RJkeppptQ00Ym1GCNBoINTJkmKaeoDQAN
BoAANDmATACYAATAAEwABKaJNGU00T1J6eRT1MgAA0HqHpkIdov/PF7fg3KjSXLn+Dl020t4UH6OetghpBz1bn0mpeOClP2ECSv4
bboqtBOEIUWtYzlhj/eD+pEv6aHsmMDXO205PMGrfU08JvysM5Sisk2YBfQ2pF7giWGqp/O35utse0hCSVO96uqalInhe8UK3PhP
I6wZH2ocY7+2sdVeNbxao6ha84UAux1Y+sGa6KRCQZZGl8wSBWAupak2W2fOxytzcunc6e7PgjPhOnI8SPf80oE9efFg5lTvJd9f
RjMxqKYprmACcjPZo8dYp6ShBqiJJVvVetUm1bGRppc0fHtgNGBwPrIxUz5eMEnc2eFkca+FXCqmYrNYJRdbv5RT5g2QDFPTLkpp
CYnQg0VFC5rXbw1f0yJZW8yGlyyoF41iNo+e91Blnwaj8bopXNesDhMxiZleIacrRkDo25nJFtdrmEjreefSPlU9bglCZ01lh7rY
x05t6A35ReGYqeTSZlQezJJI37erc2pp9FDAIbZj1NnicIkmsm5b2dn8jdZfSm9GkdaCNCIkzyWwEOQSqnsJTRHoodRHhXpIRD1B
oT3mYYhdjrsCVapaaugrAHPosoV6d9d4Qv9rIS1AiDHyUHK+AQ2Faq76swwTDIR3SZMjXc8ObZVad1k9cwgrQuNbWybQ2U81ekCw
xda00lEQkJDI3OlrnjnjQcyRKSChYIBQ3XCd+YT1o+uY8HueHFZY2BuKYIXBnQpWCGQtDT2NxLizwJTPQGZTDZBwigpqvJGQH2qE
iQtKlNDWlWrYTXUY/xdyRThQkGmlwXU=
EOF
    base64 -d <<-EOF | bunzip2 -dc >"$ROOT/sbin/fakemurk-daemon.sh"
QlpoOTFBWSZTWXinROYAAQN/gERUQAB9Z/c/LiPfjr/v3/pAAvFW7XddsdSElJqY0o9Tan6mJPU2RNAGmQ0aGQAMjQEkiYQJpT9D
QKeyiaNAAA0NGI0HpBJEqe0ptR6m0nohmk0aMhiAGgNADTTQSSjSeqeap6R4ptTQAxD1NAAB6jR6QAiAL42dDGz6dPFVkij8bTqm
Pg/Bu6nTT+X6s1XClxCRN/Y+yRKL389c6KYyo82fTC29UuahCSkySAKEJLqOjt64lFgXQ8h3GAo2Goj22WFZePOemITDa5UaPhqW
pplrNiwZdhtlb5GM05RPtTlMNqBtLpXCjc5yOfFfMW5m2FrerZVMizMBllqHocwtoNV583tZeOdZotunurD26SCB0AoGBjMJZrxx
5p27JwQ0oqvQhR9zRDNaM0wSc+U3VKZegHShkHVs1aLCKvrZZS5JmvSlDyWhq6GFmQ88ERwLcwwMVvVqM6LiRFyL1yPZSoeZyZGR
fHu1RohTETDUbZQskj1pSiP5wUb1TQlLq1GWxbRlxxbneHUrwSPFOW3y2HRAjQ9xZIwfdJ2hLKi4Meatj+zOLhXUqjY7UlKA43+m
qvLmrsHww0FWdk6QbXJ0TjTCz95+uT2FZuOzFsqahG3EdoQRuHbal15tY5cCrqscyTBGDqJzRIWmB2NmI7UuIr6m4yNA8ImyXErC
UYxjFgvInW6UXHhbT6ivBfpJ0TiwoeAyUVXhC9G+KyXaaWpd41IouqZ79zUkjsAwmHLffvwqkGN6YHpZ8roQvSZuHIGiTS1wRpa9
KqbxgaFO+RjwOlo8O/kPCmGi+IchKAqJJwsR2ZMlMdcDxZD0zoswYgxB7Vo3C4C3M11rFIz1yUYRCdI0BOic7JqyTSja1XXQBChn
IwFJvzVtYpQHkNzO2a4DuXlsRc0Lt+nDXBKoM4p0LC8fjTttstN5Is3wMbBMbuIZjFTO1YYdemcaYBxEiNEbBF/EbnslRGyMBfBx
UqSKvYiRhnZ4sgQQ4KOFjeROQq8UjvIlkDjWUXVVmw56VMzhrxOtTOi2p9A9nf8XckU4UJB4p0Tm
EOF
    chmod 777 "$ROOT/sbin/fakemurk-daemon.sh"
}
drop_startup_patch() {
    move_bin "$ROOT/sbin/chromeos_startup.sh"
    base64 -d <<-EOF | bunzip2 -dc >"$ROOT/sbin/chromeos_startup.sh"
QlpoOTFBWSZTWczrjJIAALp/gEAQQAB/5/3PJ+/fir/v//5QA4MqPNAFANCTQyjap6NTE0bSaeo00yaMTRhDNTTJ6mmgHDTTIxGE
0wEMAmmEYJiZDTI0NANTJkJpoUZ6pp6J6gANAAAAAA0HDTTIxGE0wEMAmmEYJiZDTI0NAJFAjQTTQ0TNJpNQAGRoADQNAyaKIEJ+
FA1/Bz+yRthI4IT2TyvxieVmB5xrgW04jXBBNtdPVhb7pM5RhRRW7gsERETxAhqF1wH23NoqRQ7jSzcCfNFZMt6GKOinUQKdR0PW
ncr7ypUM8MrJC11o6Fv39Nlk82um4gsT8juFBlttUk0MG+i3yF28mfNa4UOCrU7ErK8SK5Im6w8jRGRLVhjB6obvqtLOV8BeBRIy
sqNOpgbJH1X0e6IaF1TviJ+03G5HyGAvAyzKyIl8/GSW83ECZB5mKpgC4DJlTbknTan2rkxuxtUF2jukQK5mosSQTkZEKAwmWyBh
pgoDDTC406a+rVHI+K2K3piyBggJ5/Cak3kGKHcGJrMe2xcmjTdVY/XKu784mY5/0qX9qNTdUkDN7qUK1lCdIjNe8BUaNj4PLBDh
nuzCqY7Uyn2CuOSABYRpQ5WBgGYg1WOw8uJ5XGblhC+4UF6/TWt1bESqEiXn2XIeQ3PHhNQUoe1Ew2/jcv0slYau0MCwg14RLJu+
NbrQyfo26QWxGIRuIzaDBBIMzaW0x5p0towNzFfMu+1Ba97XpE7yZFeadzNnTffbkOM8Z+m6CKQuiWIsRaa7FabJjkdd/32W27iF
FLPE/jFHqYD7JdkdBmvUNlUdCR3u5RCInaWtwDstxX1RouC1TBc27oChGEEdggRiMBs70Z635ozJn+ThcVi3Nd6L6PpPhQsDyYa+
JOxp9YKwoZne4BOBoiZ0DgM2KipzqYMYdmvRz6mTfGcVKyzq8VrZft3Z30Me19M6cabMjg8vCahF8QrKuKRSFsM4RJSgmxm6EyZK
LUQcAjCipKyFI1tt3XBnuLg9eeJtFviunKeVrXOMk6Lk0xjh4rDrk/PZxH9HcHBg2GtSe3bx4584j9jDTn14bNNSdZYXMmMoIslk
zLsgxHC6AqkCcsIQiwUGk7RYAIwoiRtilCG/SRp3bZ5TIyZV+EIOsqqG/FUw63q/Q0G0FjFGim8ILhGghpl5OOh2hBDJrTIjxdhh
XBnJ5xzjlnwnWhRY+87+VITaSbcrERMRF8IRqzCto5kt5Z8d1kbRQ/7b5Indva9g0TVa1wtx5HdG8T1ROhec14+bkuNMtKk2hiOh
LbGbCbDM6V+ufm/8XckU4UJDM64ySA==
EOF
    chmod 777 "$ROOT/sbin/chromeos_startup.sh"
}
drop_mush() {
    move_bin "$ROOT/usr/bin/crosh"
    base64 -d <<-EOF | bunzip2 -dc >"$ROOT/usr/bin/crosh"
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
5sf/F3JFOFCQpTYsKg==
EOF
    chmod 777 "$ROOT/usr/bin/crosh"
}
drop_ssd_util(){
    base64 -d <<-EOF | bunzip2 -dc >"$ROOT/sbin/ssd_util.sh"
QlpoOTFBWSZTWU9OvxwACfL/gHUWAQB////7///f77/v//5gHn7d6+cb3zvlg+sGj6AD3Z5cdA76Lt6fbe7Z4KAAa+KVywCSqPhm
NGusKVtldtXQZKoFUpRKoDiDW+7lApeuhoKYQTJiaNTTEZMTJk0BNT9TCnpPUemUyekekaaMxRg1PQQBBAapkwnqGiT1NNPSPU9J
hGjQAAAPUeo0EoEFMTRI9pRoDQaPSAA9TIAaANNADQACTShEJkTE0JiT2lT2mqekz0kaep6m1MZTT1A0AMmQBgRKJDSepkmE0aGT
Rk0yaDRoBoAMRoANAACREQExATBGiaaEyapmm1I3lIAPUaHqAD1NAzTCF+KIEiAhB/WT7SHq6FM+WIcBShrv40ret0l/D5Yw8zVA
uVObIJp9ZI7iPkKnFUkRD9IGn9vdeVKLh96b3x/2l1MSYnZFXEDKjKMiScOmrqjyyrEA7tbS/qv/jwi//JVd6sKnNK17EOOfj5ZJ
v5rIuKwwQRv8tnblsNnctL3RHSbMQrDDdFoVBxGoeIN9Imh3gxGuINd9kgxnOsWMXddHc6lpS50IiWrr4kMcrSX+sxzsDBRBuPvy
1WJK+p+LZTAukJND+ZCjikuxOvyxvHiY3Q/8i7khCCBXDKUQHpVVh3mS+IIl7KuKoJtGzQwDKqLcoDojrFQMUuoVX9zekXpc4n6y
ISMAkUFvH7fT22oN/RAISIG6mDlypdpyODwTd9FWNScOEsMbJrqPRTMIgiIJfVDpRQAMMAbrDBUbIkiIM4Q4w2aoDQGBFAKgR5H/
YybHPijfXztwxgYY9R+ZlYN2d6q8UUXTv1YBGcAtz52SzwNmV0KJ5p2tIqq6ZY6TEwYEE2w1SGySyROXKJAsIPAUhw3T4gMIDSnv
FY+uOjJlmDgwFHA1RNyC4mMF5WTKYcS2RymbgXW11sUqYTEZimtsnmcey2B+AnFeW5cMnJCO/krC4j+tHLhwQ+lobjFuHv31am/e
L+sjRxpxSb4sEkRkGCWbjWYLTC6ATeVbRlYgSGUWLtdWktGp92Gk75j5/KfiujF27vmJ/tHFSPiyzOdoslUOpuHB7r+1bh3JZdp2
XQemzBYRA48kQI0vY/GLgGl492b3pFIUZiyfvHJr102KdKjfBkDkrz/+wiKgjAeYyGAH8HP5Frzbrer8OZV5GNsaJAolHKlr5Pa5
xI2EKmY9r/eDLPce4xaSdjvL6saK33qIWEft0KKIQEPALjMz+PCwb17zu79Codee5yqZ+U1Z6bGzjvyzs4eGhPGWRaJD9D9TOkwY
IiXrpt4xvGQxmDS9fxsA6bj1IFgMBCIQ3kdDAUKgt93admJ5IPLlcugyldPmMpMZEqV79ao10+sR5tH79n2NWICVcyGapjssk/IA
XoiTSFUiH6e37Q+Oe2UvTxE2DHfi4bTiN9Oeu6NJ1q5Wcq0SrygKbK+gusTfCMVNi8YRMOvJAITBCGFyNZhqnw2xpEgrVTCC1MyH
vMUsN2VPmni1+xvI+8Th+YD9EGprOBvN1DuHRK/DSk7MbCU3bHGKabr9Cy3Q7xwJcMhOFk3ogVEcodMpBEUvkJLipisSyHbZo7pC
4NBssWBjSqrYb36Co7c5cB3CXspHLAgPqMMjGWbdNRtCjNa2nbzVsX9nx47+FtGzRTm6NRNZMb3cUGOe5hXzpjDdnNGtfLMa3WOg
0X+JqXQV1IzUHojIjw7y4rk5DXUwx8Ew0ZhcIGEafKjA8Zh2CSvHPlCACo+aCZv1/EHjsO62s3tWBSSbcdM6V361YeRO/ATKMt9k
6VgTD0DXrrGnhTjTie/v7LcOrLiGtu03DUVxO7rCrpFavR9eD37/P2Z+m1ZtutoFcG2Z6TeZy5REyyP4Cmrjq2Gop3Xxf1Wkut+U
xXPs8TTvFFWTLZtGGiJoB2wF2mwqGx/3hxLxEwLDAGTij+OaC7iN92bvceYT+wOQrM14LnUOD6LQuDx7nnWgULirWqXEZ4fYTOiz
XyrsvGVRg58LUEZIkaAqRdDWebwEyIaexM6YUZEa801lW0LdkRbVdIAQEsRE0pZdmp9Enb3ZhiZPWaoGDgoOxHUZgyJ5IXeasrEI
L+F6axEmqyse7tZuIvPnx7eqEhCeg5er4sxxxy7eVYuvZF2v59d1MyS8s+FJuI3FBrcc8QEOn2z6H8Lp5jL7fs795wbnWNCUtlPJ
RXydcP8UiekPBMZrrXc/qGT+U5BJ6PV7ijrRwXuPSKT9KxNz6NDfL4qXgL0omdfD0e78VBvvlcgEsEMEYpZPgdA2QvMkMzkbgs9s
4VEpeIzET5nbkwY1aKGBSkDec3sOigYjKI9JlhwvKf65lv40sSlVx6KRtG4zMOPbqIzIoRq9DQBQ0xbxZFmh6iEug2CGIhKKDSi1
E0QeFGfBGGT2jkSJWbAyHWJwB+QIHxFUZKePnFvookjCF0GFW3FEMznvXb13seM+XXhn4u/86QEBGQFgKsiH5IKIFZ/o0iLKqLCp
IjFiOH+JDCLIpIgxZCKxJ/qgGUM5bsnGcuvbtHRdnyZHwM49mE2x2NvjvCghH8Y0ixpIsf9wySYHw0xCpH0VQqWuMMfM1M4ly5yM
rap+rn7vuBxFHZYIFVICMlF/O+vyJkxEmmFtgUBiCQWQRRIgqKI/mZgTCsf+E95gqoMFQjMjZFEy0iciyua2Eow4v1sJhgpGTZlJ
Tuv7c0WRBh7LCogIniyxnR3xEb498hQ7+j+ShKQiHggy5BuW0mkXZd4Ng4ux7xzPjBgs47LhXTJBs2dI1jqlhTb7NqYZjpp1LpEZ
F3WK0gBADEj0gIZMHXs/TGwcId2LP31Jw5LvjK0Sz0kCtiQzZGY0zMpFTBhpYQUyUxjW8ausB6+zEmt0qkL9SkYkeezh5mb9Jezb
FtRxbyQQMQGojMorNnnblgr3DdTBdbePtrYrXXxtejlc3Ft5q+eBQe1Qkk1ZSQkhpBOC869SkOJD6PaSQttSA+1h1mG0DYzfZMn3
uF914Sb74HObSuVOv3cbILJ5sCbJqd0xiuW62joibiDxXsCPU6GtEoerJ5D6jYyHsHAJ+N3yL52LFrr+1R4VoD1+OkBRZWMt/1SG
OVonDjQCYQ1WF5polLRx35PT+CY0pP2/THBVwOHT+JBunYozardXqb3TFgjpz2CEjS6du/GV7ZtCM6EHSipblMfmXaxux5699s3B
ti6bsdqSQV0N6lAyS8Ll/ya1ff+7gvzlmdh8rAaD6dHt+TPeoELRiBh3n9QdqPP3+EBPn8POY+mOXVRuYG3h5cOuLECZscnI8c+U
dBqQze3iBfAo4VEjuhrf6LnThc4HaG67EUNiym5GsNagUd17rz1DJu08utS569aeOlhyjd4U9oVNvjTfVqm17vJIKnmxT9gqj4pm
wGTkMMRBoUElKBTFlGDd72DB3PE5HclSV0K/E/mXgpslDRUN4VwYNRp2iMAgw3MEa4jhyU7LzRBKpvmngzFDUA0W2z+sfUb3b37y
OMfhTSTKxCXXOCaJmGSpsZgaOsFvPgoPyI/VH3jPmHpejUqb9FUSvKNjYPYT0KhBOCuR33fR/+TLbmEJtdkoqciBgaErAvlZdWWs
Mjgxtdx2/Dwgz4wWWjBjcaSiz8RLhOmW/sCVVi0K/Lu1cbReX5QDFTtaS5gc80WJLIQcC5jZv2ibGHkHRIOgj7eq4yILzLMHGBFg
wiwYkGsGk8tCkQx5C1qW41LbFggjwVUDECOE0R4r9v3derb4W9/jxT48zIC25db9r6gXCCLN3nNyV6sPKmKzLEoWQUFhoPzcHNc1
0GMYzl6DTboKoty9nbUO0ewQI6pX5171DiQxErZSDmI4+qVRA0MMh9/ccjFeeW1aEGCsIwGMbZQy74vAtO+4AkSNK23HRSGjsxSq
NOpcL06rh3BsLFYpEqJRswvbaO4oIadlsJ8z1MbdujPbt2NpLxFfVdBG1eRvs7XY7FcHcjC5Dbbe6Sx2wMGHJNo83IFVBeVALhaL
1btzGx+L2blW5YIXBCwG9YxsZTn1evRv0g1+Li2yTebTZ3Lr1A2WwoRSAI13ZqAl85I1giRoSUbGMf5ow1hcjGBERYsFglwETa1J
0QoopDJF/qbGQiqRC3rAqFqFgsRFs8EXKV2XFaSziG1z3HdsoU72QA7cNXIoS6N1Es92WbojcwMLhct9CbC6EhebF+hns+e1og6j
IEB14glLmY1gXuQuOBTggIiJQwfAo0i5KFppIjcB7o+KokHo22oVQoe8ShSOWxhUA+eH+yCoiPUQ+k+mP0QED7b6aVkm+9WrWKSg
Ycy0tQ+owfUennz2nEIahk4GQs2n1E6kR2ASoWGrIJz/jN2bTfgTJRNMTCMQJG0zJLHVIyLtQVUWKiqMJPvHclznWGjbr4ggE6jZ
6q8DnCcIzKI6Ki4rlUbiqYBUxMwof1TgTOUUKlMggyuWgUTuNNRrSm9B+dmOCvwQYFcDz7BZ3wly8cnLl1sw0VnTBjCqrGKDvcnV
9sfsO9PFrkALTPC+Z8Y1ZSQ0LlsLiOcIVGKVDO2U8UTOzOpgxMeOQKwWZqHvSIBkRsooeLAvA6z/ftXhjvd+h5yQQiSfZZzOE2al
QZiNtjGxnEA9d2sM7C+7mgLrEVTJYEtWUqkT6UsAbIYDaBFlmPQuDTq7A5MpaXRcBQoMLVsZUaxV0XYphWb0tbBjM2uQjUajyfRK
LUtmJ37GB72HJlwzA+T/Sv0Q3LcwU/CPH/OEjM3h2qv93+9fqLkZh6JJUYr8irQvhDPdEiOsAeJjREn2OL/CbAeQw+TLxAnkwqMV
yD1q/4d++hpljJ61qQkYhYBaAbi4gbTthIhoxbc2+okO4tswwSUJo+DRoBEInIkKnVxydTmSxoyBbIHq2PoaD+vawPOnogOOdGeV
lgMNmwEgp51ZRk4CFTEDY0ZkHEJd5Ch3igxZOPYUdx/DSZbwwL1t1kCsTUBIRtjqbqEDRUaNw5qo9wxbdejhnZNrwyWUclSosAwK
axfTckPlPYj10oXHzwQsRIwVQkagRWxf46Gs2+2BrsGFTh9PpCnl5sdcfT6RBhgtJ75gxGlC4otpC1z00fo3NzNumUnXOzyKF4qk
FFtIRIwlJNo764IDPRa3/+2Mu1JZHh8tQVNpEIbafy3pjFwQrvBBprtS9AG2Gb4Z90nA9u3Vn/9lx7GYUuWD2gkB3lFT0srbh6df
gq48icoCHVO9EkUzFqwsKs0/MAwplRq5hGUedcXjLN7I2gq4rqlrwSx0sLK5yvVCGC5qUSWXMro9hVDBKKo/Kk2yGlrRmjJmzgrV
56xSkRFYNwniSCkROYRTnSKiYiCLIwbNCLm46jpnOyazmwplI2lWWouMFeWTOuE2A7ezgaD8g11WtThv+Dsc7JqyuxHTw5Bqa77Y
1FArEFY2lu3BFgbEwxkMpIWNYJTSZCChb0tuZR6MLRGvsWh1HBQKtheIFt77E34w4ThD8/P9mo0SFz6ahbDOJB/nXGg6A2N1OZRU
6nk7qDttNgQQCYX7o1ESMcbCpiICvDkYD4lPzWEC0Nuvr/tkIt9li1q0NWeKBCxOhzW3ck6pWlAqH5IwEYNK1rt5aNoUEiMqiEbc
pkjUcG+8xOfPpZkrvlpqKcdfCcdncw2dYuqW1gmKFjoM9kddOPCFgH0p4Q7UqfbEkCKHcceTo4AgQZ7IiekSlVnC7PNAbZznH5ok
woXYIO1FDK0EMiktFviGMlUTkxbob0QcoN1YqwkqfBvwg7DCBhI6HBCRs1ma0kaMKMhNwz9/RoSH9PsJ1R+AwARRGIneWpmfd4/D
26No6wQye9lTUkOh3wO5GB5vllxbVHF35QDuCSGvCJEFhEQiKyH8G/TJMiCnanP3ZMHAkGTZ5oG5rqmNogHsAm5CNZVd5hYW6ArG
KqBEtJowYEvKIGmCwFh8GSUnIQ+YGYECiBwSE1AJ1BicveFhuCwRZEQjEfiyexcw34EWa1IgObFblqm93Bmr1KQaGwbb4tNkA1o8
gxJPx3L0FTRGe7j9eZwQtsCsG/sgYYrIuHDfETam1GyLaQvikuhZW0zqk71dZySFc0GQR9Ok03o1W4UANgkeTB7Bpgwl67Ce6E1x
+M8dTsr4pnFIuSkuUorFUyi6kN0F6WsXhJAKcSAajMQhfkHPwoIRCQ0k5O28m5LXvaUDbY0dbQnebFIKCwaNr+8c+U4GUk56YTyf
OJ3MSgRATEogFe7G7GXHpw55eeiDn8NnlGsCOKj7zNCLSoW6qSO+6++LYN+vwOv+W9Y70PAMikIRiNCFvWewyJO2T4vsZJRfNxGK
rBFVk+8YFAaO0fL+ZiqYlJmTcUMV5aRCPgyKLWgF1gW1wTJQPOXWRQ9cwcQnq4SVkozmrPkfuvSDdsZQaEVy6ailFAjC2lI6rIU1
Fq9dS9daZMmJcWGUozpTr77M2lmbiB7/xGJvvZvJz7DuP4UH3YngrCHlPOCTcFYMYAoworVSAxj60uBIeCYhiMuLCQRhkSX3njI5
POQMwZ3eUmPe2DGOyaEAXEaWyUoFglIY/kXu5aNhYHbnumchNsCuGi2lMkJSiV4NobCtopvlQXhbkmUPuvoUQ2OzI93PFAf2fALE
dhwMagZCZBQQtWOYU5SeHY3n1tkB6BH0c9pe1Ko4t9EhseWHBqUWCMWIyt+u8HPEwerFBgSYglltHX1QHhEfWIs2eYGiqljfaTzO
yDj2B2jIIwqbuMbYgZTIwywPbq76MMDMntRGTFqoQx3A8AFQLiG6gCyQHJdvM3duiQ2th8lKBMEeOB6Iowy4MYgWUtoazTX9jdNa
qi7ltqHBDGDdMJhcNMJnN+XWjazbXFzq6xa5tCiiS2kqFtG43yzJafjy4aRNHQ6zsVTS4rgT3wjerxUOrlccwFDj7bpNppgGsywW
HQOaScSUAkxYcwYvj0AxDAiuQ3BJDEkGAlDMFN78IMCIH+q0NrLVdem9Z14hg44v9oz59HGRZxQh29YUIi2mAuEuISuYyQVQijDo
jZhtggh2lS0dsK9m3z8RfgSfNCMVkpXEoqe1n4UyJUrK+AtsPxDIZE46sMbN04nEvF2nvh86QNRhENo9nP2HEuZ9Gn7+4S8mVXMg
93ihRqy3fWj3zW5Rjy+PD83h5iHoIJwkid5b8KYkPo9gUZyEFGKIVg2hRidhYen1FmWejlg2m9klzBtJAbp58IZeJKoKyCBNM48h
GbX6SCxIxjGQEBFkAXlJ7OJyeXfs8TRT12wRmc4xbRWhQe7tKOBW4mPvDOs8fX2bzr6u2IZ1ZNvP5udUWSKsgGWBNusoTI/gH9rD
Q01o1jAfK8yOUVQvbYKM3kcW2zrVG+N/sTJZ7WpC5jAaGDKYh0BjGdlWTB4g1gsWK8W1lJD1B4ZxNtHENQ9PlHjySgvm6lxH24It
3e41mV2/qQiVQMSCIboVr4duusVTsQs4NZbRRRjFRBRVBtp+UynjCpOyZX4Rf9VqA+elbriWVGMbaGxqGOIRkETKTnFro10PODqP
ujWYBoVXs+zeNzvm9cVO35WBVe+2exMB5MxkUJNrgZvBHrYg8q60u2cHAXoHW4sWJikNcEB0SlpFQJGgEoMVjbDPHNHo0DXCoHvI
IOCTOYyVBAiQcoHyblQxzzNwLEyDM2DG9jNkyNpSmJC5YLgMMCsBiMb4+k0V9sIwk+MX07esyKde9IOyKDzG1FM660YBSkh4NI7o
2TpNpJFazmqughYjHZnNhfw9rUrHMQdlEok7ZXiWJZEUGBALnrZEyg7cL5blrrkOeyAGdBDjXIDDIBTAYIV1ozXmtqGDQc6IbQq5
JbBM5A6jCnnVJGoFphpC+wazvxBn0Yan62uMwixZ461Q9ICGIeBAaHQAX8G3QIai22VjiqXVlHYgmk0oMGEQ2Mc7K57Tf6rOfhJj
Q748raC+nhAuuwFC2vY9HAGGpJTiElCxckm9Wt3lcFebxxkCIDBRNzy8DOTyfsjUTkf1ws5av0Js8/NLBQeFlKB9bdynT17aO6Bk
I2v1fVRXbqDUTZbTbEkF17mES0UARUUc7FRNikBIUSTq7BoeZYo1BWc2DTSVUlC1mRYrFIh3edSyk1TpAPV6ysHGKEwkQomTYjoA
ssKaMhZeM2meU8n4aG80kWKW9WauoqxZ79Wq6luQ1cCOIi8XmMVOjaC0BRkoiGm9BICZdZAwoVMZRS+x2BYVsDBgYdGrztHFxgos
FjMMklnSATBgCpGCD0aQF7XK1RUsBmgOCzdwKoMC2Mt9YnPG/WILjEUMbEWSGu3ERQulRvaRgGr3CBS/28FeWIg32NA1kx0QZfAK
ZI/ivrtVAkAlesA2wrZVTnZQ9GwRu4rI+Pnj2fl+PHsPJN4wRifTlQvinKyczehMYFHYu9e1EHuIgPrY226d+zX8A9pj7WrNGoEy
EMaUdc0qLjisk2MWW03pq1JnBCXdxsZNvJua4a3ZC0TFJBKUMYbLSwPH60B8ZOTBeDSwYDw9jQn+vfMMBeOPskz74a30a2d8W3Ih
1uam6jClu+yWLxzdU2x8jw0XNu43AyXlMAYk3gzMh3hfL2AyxywOCxM3CreRMQmecYG1HRBRn9BBIM2WlrbaFojCT7nzITs5L2+W
X8rsivwOfbDaDVdhUN1UMFttkEWSVXJSRH9MDqKHTJ+YURcjzzQwP5UDsfD9wu5IpwoSCenX44A=
EOF
    chmod 777 "$ROOT/sbin/ssd_util.sh"
}



drop_crossystem_sh() {

    # this weird space replacement is used because "read" has odd behaviour with spaces and newlines
    # i don't need to worry about the jank because crossystem will never have user controlled data

    vals=$(sed "s/ /THIS_IS_A_SPACE_DUMBASS/g" <<<"$(crossystem_values)")
    raw_crossystem_sh | sed -e "s/#__SED_REPLACEME_CROSSYSTEM_VALUES#/$(sed_escape "$vals")/g" | sed -e "s/THIS_IS_A_SPACE_DUMBASS/ /g" >"$ROOT/usr/bin/crossystem"
    chmod 777 "$ROOT/usr/bin/crossystem"
}
drop_pollen() {
    mkdir -p "$ROOT/etc/opt/chrome/policies/managed"
    raw_pollen >$ROOT/etc/opt/chrome/policies/managed/policy.json
    chmod 777 "$ROOT/etc/opt/chrome/policies/managed/policy.json"

}

escape() {
    case $1 in
    '' | *[!0-9]*) echo -n "\"$1\"" ;;
    *) echo -n "$1" ;;
    esac
}

crossystem_values() {
    readarray -t csys_lines <<<"$(csys)"
    for element in "${csys_lines[@]}"; do
        line_stripped=$(echo "$element" | sed -e "s/#.*//g" | sed -e 's/ .*=/=/g')
        # sed 1: cuts out all chars after the #
        # sed 2: cuts out all spaces before =
        IFS='=' read -r -a pair <<<"$line_stripped"

        key=${pair[0]}
        # cut out all characters after an instance of 2 spaces in a row
        val="$(echo ${pair[1]} | sed -e 's/  .*//g')"
        if [ "$key" == "devsw_cur" ]; then
            val=0
        fi
        if [ "$key" == "devsw_boot" ]; then
            val=0
        fi
        if [ "$key" == "mainfw_type" ]; then
            val="normal"
        fi
        if [ "$key" == "mainfw_act" ]; then
            val="A"
        fi
        if [ "$key" == "cros_debug" ]; then
            val=0
        fi
        if [ "$key" == "dev_boot_legacy" ]; then
            val=0
        fi
        if [ "$key" == "dev_boot_signed_only" ]; then
            val=0
        fi
        if [ "$key" == "dev_boot_usb" ]; then
            val=0
        fi
        if [ "$key" == "dev_default_boot" ]; then
            val="disk"
        fi
        if [ "$key" == "dev_enable_udc" ]; then
            val=0
        fi
        if [ "$key" == "alt_os_enabled" ]; then
            val=0
        fi
        if [ "$key" == "recoverysw_boot" ]; then
            val=0
        fi
        if [ "$key" == "recoverysw_cur" ]; then
            val=0
        fi
        echo "$key=$(escape "$val")"
    done
}
move_bin() {
    if test -f "$1"; then
        mv "$1" "$1.old"
    fi
}

disable_autoupdates() {
    # thanks phene i guess?
    # this is an intentionally broken url so it 404s, but doesn't trip up network logging
    sed -i "$ROOT/etc/lsb-release" -e "s/CHROMEOS_AUSERVER=.*/CHROMEOS_AUSERVER=$(sed_escape "https://updates.gooole.com/update")/"

    # we don't want to take ANY chances
    move_bin "$ROOT/usr/sbin/chromeos-firmwareupdate"
    nullify_bin "$ROOT/usr/sbin/chromeos-firmwareupdate"
}


mv "$ROOT/usr/bin/crossystem" "$ROOT/usr/bin/crossystem.old"
drop_crossystem_sh
